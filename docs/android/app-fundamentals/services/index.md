---
title: Android サービスを作成します。
description: このガイドでは、Xamarin.Android のサービスは、アクティブなユーザー インターフェイスなしで実行する作業を許可する Android のコンポーネントについて説明します。 サービスは、音楽の再生ファイルのダウンロードの時間がかかる計算など、バック グラウンドで実行されるタスク非常に一般的に使用され、具合です。 サービスに適したさまざまなシナリオについて説明し、実行時間の長いバック グラウンド タスクを実行するためでも、リモート プロシージャ コールのインターフェイスを提供するために、それらを実装する方法を示しています。
ms.prod: xamarin
ms.assetid: BA371A59-6F7A-F62A-02FC-28253504ACC9
ms.technology: xamarin-android
author: conceptdev
ms.author: crdun
ms.date: 03/19/2018
ms.openlocfilehash: 4ae86ca5fa47169bb5d78eb9d1116e419c23ed6d
ms.sourcegitcommit: 91a4fcb715506e18e8070bc89bf2cb14d079ad32
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/15/2019
ms.locfileid: "59574807"
---
# <a name="creating-android-services"></a>Android サービスを作成します。

_このガイドでは、Xamarin.Android のサービスは、アクティブなユーザー インターフェイスなしで実行する作業を許可する Android のコンポーネントについて説明します。サービスは、音楽の再生ファイルのダウンロードの時間がかかる計算など、バック グラウンドで実行されるタスク非常に一般的に使用され、具合です。サービスに適したさまざまなシナリオについて説明し、実行時間の長いバック グラウンド タスクを実行するためでも、リモート プロシージャ コールのインターフェイスを提供するために、それらを実装する方法を示しています。_

## <a name="android-services-overview"></a>Android サービスの概要

モバイル アプリはデスクトップ アプリなどがありません。 実際の画面、メモリ、記憶域スペース、および接続されている電源装置などのリソースが満載のデスクトップ、モバイル デバイスはありません。 これらの制約は、動作を変更するモバイル アプリを強制します。 たとえば、モバイル デバイスで小さな画面通常意味は、その 1 つだけのアプリ (つまりアクティビティ) を一度に表示します。 他のアクティビティはバック グラウンドに移動し、すべての作業を実行できない中断状態にプッシュします。 ただし、Android アプリケーションがバック グラウンドがないといってアプリ作業を続行することはできません。 

Android アプリケーションは、次の 4 つの主要なコンポーネントの少なくとも 1 つの構成されます。_アクティビティ_、_ブロードキャスト レシーバー_、_コンテンツ プロバイダー_、および_サービス_します。 活動とは、ユーザー、アプリケーションとやり取りできる UI を提供するため、多くの優れた Android アプリケーションの基礎となります。 ただし、同時実行やバック グラウンド作業に関しては、アクティビティは常に最適な選択肢
 
Android でのバック グラウンド作業の主要なメカニズムは、_サービス_します。 Android のサービスは、ユーザー インターフェイスのない作業を行うように設計されたコンポーネントです。 サービスでは、ファイルをダウンロード、音楽の再生、またはイメージにフィルターを適用可能性があります。 サービスは、プロセス間通信にも使用できます (_IPC_) Android アプリケーションの間。 たとえば 1 つの Android アプリを使用は、別のアプリから音楽プレーヤーのサービスまたはアプリが (など、個人の連絡先情報) サービスを経由して他のアプリへのデータを公開します。 

サービス、およびバック グラウンドの作業を実行するには、その機能は、スムーズで滑らかなユーザー インターフェイスを提供するために非常に重要です。 すべての Android アプリケーションが、_メイン スレッド_(とも呼ばれます、 _UI スレッド_) で、アクティビティが実行されます。 デバイスの応答性を維持するには、Android は 1 秒あたり 60 フレームのレートでユーザー インターフェイスを更新できる必要があります。 Android アプリでは、メイン スレッドが多すぎる操作を実行し、Android は、フレームをドロップはぎこちなくに UI を順番に停止するかどうか (と呼ばれることも_janky_)。 これは約 16 ミリ秒 (1 秒 60 フレームごと) の 2 つのフレーム間の時間で UI スレッドで実行されるすべての作業を完了しなければならないことを意味します。 

この問題に対処するため、開発者がアクティビティでスレッド可能性があります、UI の妨げとなる作業を実行を使用してください。 ただし、これによって問題が発生する可能性があります。 Android が破棄およびアクティビティの複数のインスタンスを再作成が非常に可能性があります。 ただし、Android では、メモリ リークの可能性がありますスレッドは自動的には破棄されません。 これの典型的な例は、ときに、[デバイスを回転](~/android/app-fundamentals/handling-rotation.md) &ndash; Android は、アクティビティのインスタンスを破棄して、新しく再作成を試みます。

![デバイスが回転したときにインスタンス 1 を破棄し、インスタンス 2 の作成](images/image-01.png)

これは潜在的なメモリ リーク&ndash;アクティビティの最初のインスタンスによって作成されたスレッドは停止されません。 スレッドに、アクティビティの最初のインスタンスへの参照がある場合は、これにより、Android からオブジェクトを収集します。 ただし、アクティビティの 2 番目のインスタンスがまだ作成 (さらに新しいスレッドを作成可能性があります)。 立て続けに何度もデバイスを回転、すべてのメモリを使い果たしてしまうし、強制的にメモリを解放する全体のアプリケーションを終了する Android 可能性があります。

経験上、として実行される作業場合に、アクティビティよりも長く保持する必要がありますし、サービスを作成するかどうその作業を実行します。 ただし、作業がのみ、アクティビティのコンテキストで使用できる場合は、作業を実行するスレッドを作成しより適切なあります。 たとえば、サービスでのフォト ギャラリーのアプリに追加された写真のサムネイルの作成する必要があります発生可能性があります。 ただし、スレッド アクティビティがフォア グラウンドでは聞こえるだけをいくつかの音楽を再生するより適切な場合があります。

バック グラウンド作業は、2 つの大まかなカテゴリに分けることができます。

1. **長いタスクを実行中**&ndash;が明示的に停止するまで継続的な作業になります。 例を_タスクの実行時間が長い_アプリ音楽をストリーミングするか、センサーから収集されたデータを監視する必要があります。 アプリケーションが表示されるユーザー インターフェイスを持たない場合でも、これらのタスクを実行する必要があります。
2. **定期的なタスク** &ndash; (とも呼ば、_ジョブ_) 定期的なタスクは、比較的短時間のみ (数秒) は、スケジュールに従って実行されるいずれか (つまり、1 日 1 回や 1 週間、場合によっては単に 1 回、[次へ] 60 秒の場合)。 この例は、インターネットからファイルをダウンロードまたは画像のサムネイルを生成します。

Android サービスの 4 つの異なる種類があります。

* **サービスのバインド** &ndash; A_サービスのバインド_はいくつかその他のコンポーネント (通常はアクティビティ) にバインドされているサービスです。 バインドされているサービスでは、バインドされたコンポーネントと相互作用するサービスのためのインターフェイスを提供します。 サービスにバインドされていない多くのクライアントがあるとは、Android は、サービスをシャット ダウンします。 

* **`IntentService`** &ndash; _`IntentService`_ の特殊なサブクラスには、`Service`サービスの作成と使用状況を簡素化するクラス。 `IntentService`は個々 の自律的な呼び出しを処理するためのものです。 複数の呼び出しを処理できる同時に、サービスとは異なり、`IntentService`などの詳細については、_プロセッサのキューの作業_&ndash;作業がキューに登録と`IntentService`1 つのワーカー スレッドで同時に 1 つそれぞれのジョブを処理します。 通常、`IntentService`アクティビティまたはフラグメントにバインドされていません。 

* **サービスが開始** &ndash; A_サービスを開始しました_(アクティビティ) などの他の Android コンポーネントが開始されており、何かに明示的に指示するまで、バック グラウンドで継続的に実行されているサービスは、サービスが停止します。 バインドされているサービスとは異なり、開始されるサービスに直接バインドされたすべてのクライアントはありません。 このため、必要に応じて、正常に再起動する可能性がありますので、開始されているサービスを設計する重要なは。

* **ハイブリッド サービス** &ndash; A_ハイブリッド サービス_の特性を持つサービスは、_サービスを開始しました_と_サービスのバインド_。 そこにコンポーネントをバインドまたは何らかのイベントで開始する必要があります、によって、ハイブリッド サービスを開始できます。 クライアント コンポーネントは、可能性があります。 またはハイブリッド サービスにバインドすることはできません。 ハイブリッド サービスは、停止を明示的に指示するまで、またはにバインドされた複数のクライアントがまま実行されます。

使用するサービスの種類は、アプリケーションの要件に非常に依存します。 経験上、として、 `IntentService`  基本設定は、これらの 2 種類のサービスのいずれかに与える必要がありますので、バインドされているサービスは、Android アプリケーションを実行する必要があります、ほとんどのタスクのための十分なまたはします。 `IntentService` 「ワンショット」タスクでは、アクティビティ/フラグメントの頻繁なやり取りが必要な場合、バインドされているサービスが適切では、ファイルのダウンロードなどをお勧めします。 

呼ばれる特殊なサブ カテゴリがあるほとんどのサービスのバック グラウンドで実行中に、_フォア グラウンド サービス_します。 これは、ユーザー (音楽の再生) などのいくつか作業を実行する優先順位の高い (通常のサービスとの比較) が指定されたサービス。 

同じデバイスに、独自のプロセスでサービスを実行することも、これとも呼ば、_リモート サービス_か、または、_アウト プロセス サービス_します。 これを作成する多くの労力を必要と、場合によっては、エクスペリエンスを向上させる、ユーザー、アプリケーションのいて、アプリケーションが、他のアプリケーションと機能を共有する必要がある場合に便利です。 

### <a name="background-execution-limits-in-android-80"></a>Android 8.0 でバック グラウンド実行の制限

バック グラウンドで自由に実行する権限がある Android 8.0 (API レベル 26) で不要になった Android アプリケーションを起動します。 フォア グラウンドでは、アプリは起動し、制限なしのサービスを実行します。 Android は、アプリケーションは、バック グラウンドに移動したときは、アプリが一定の時間を開始してサービスの使用に許可されます。 時間が経過すると、アプリはすべてのサービスを起動できなく開始されたすべてのサービスは終了されます。 この時点で、アプリの作業を行うことはできません。 Android では、アプリケーションを次の条件のいずれかが満たされた場合、フォア グラウンドであると見なします。

* (開始または停止)、表示されるアクティビティがあります。
* アプリがフォア グラウンド サービスを開始します。
* 別のアプリがフォア グラウンドであり、バック グラウンドで必要なアプリからのコンポーネントを使用します。 この例は、フォア グラウンドでは、アプリケーション A がによって提供されるサービスにバインドされている場合アプリケーション アプリケーション B からも、フォア グラウンドでと見なされ、バック グラウンドでの Android で終了していません。

どこででも、アプリは、バック グラウンドでは、Android がウェイク アップ、アプリ、数分後に、いくつかの作業を実行するアプリを許可するこれらの制限を緩和いくつかの状況があります。
* Firebase クラウド メッセージが、アプリで受信された、高優先度です。
* アプリでは、ブロードキャストを受信します。 
* アプリケーションが受信して、実行、`PendingIntent`通知に応答します。

既存の Xamarin.Android アプリケーションは、Android 8.0 で発生する可能性のある問題を回避するためにバック グラウンド作業を実行する方法を変更する必要があります。 Android のサービスをいくつかの実用的な選択肢を次に示します。

* **Android のジョブ スケジューラを使用してバック グラウンドで実行する作業をスケジュールまたは[Firebase ジョブ ディスパッチャー](~/android/platform/firebase-job-dispatcher.md)**  &ndash;これら 2 つのライブラリをでバックグラウンド作業を分離するアプリケーションのフレームワークを提供します。_ジョブ_、個々 の作業単位です。 アプリが、ジョブを実行時に、いくつかの条件と、オペレーティング システムを使用してジョブをに関するスケジュールし、できます。
* **フォア グラウンドでサービスを開始**&ndash;フォア グラウンド サービスは、アプリがバック グラウンドでいくつかのタスクを実行する必要がある場合に適していて、ユーザーがそのタスクを定期的にやり取りする必要があります。 フォア グラウンド サービス、ユーザーは、アプリがバック グラウンド タスクを実行しているし、監視タスクと対話したりすることもできますを認識できるように、永続的な通知が表示されます。 この例は、ユーザーに、ポッド キャストを再生または後で利用できるように、ポッド キャストのエピソードをおそらくダウンロードされているポッド キャスト アプリになります。 
* **優先度の高い Firebase Cloud メッセージ (FCM) を使用して、** &ndash;と Android にアプリの高い優先順位 FCM を受け取り、そのアプリを短時間のバック グラウンドでサービスを実行できるようになります。 これをバック グラウンドでアプリをポーリングするバック グラウンド サービスに適切な代替手段となります。 
* **ときにアプリがフォア グラウンドの作業を延期**&ndash;前のソリューションは、実行可能なかどうかは、アプリを作成する独自の方法を一時停止し、アプリがフォア グラウンドに作業を再開する必要があります。

## <a name="related-links"></a>関連リンク

* [Android Oreo のバック グラウンド実行を制限します。](https://www.youtube.com/watch?v=Pumf_4yjTMc)
